<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Edgar</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h2>Edgar Calculator</h2>
    
    <!-- Event buttons -->
    <button class="event-btn" onclick="showForm('attack')">On Attack</button>
    <button class="event-btn" onclick="showForm('crit')">On Crit Attack</button>
    <button class="event-btn" onclick="showForm('defense')">On Being Attacked</button>
    <button class="event-btn" onclick="showForm('climb')">Climb/Fall</button>

    <!-- State selection -->
    <div id="statePanel" style="margin-bottom: 20px;">
        <label for="combatState"><strong>Combat State:</strong></label>
        <select id="combatState" onchange="updateState()">
            <option value="normal">Normal</option>
            <option value="mountain">Mountain</option>
            <option value="flow">Flow Of All Things</option>
            <option value="wind">Wind</option>
        </select>
        <div class="result" id="combatStateDesc"></div>

        <!-- Mountain-only inputs (hidden until 'mountain' selected) -->
        <div id="mountainInputs" style="display: none;">
          <div class="mountain-row">
            <label>
              Damage
              <input type="number" id="mountainDamage" value="0" />
            </label>
            <label>
              Elemental Damage
              <input type="number" id="mountainElementalDamage" value="0" />
            </label>
          </div>
          <div class="mountain-row">
            <label>
              Dice Result
              <input type="number" id="mountainDiceResult" value="0" />
            </label>
          </div>
          <div class="mountain-row mountain-actions">
            <button id="mountainCalcBtn" onclick="calcMountain()">Calculate</button>
            <div class="result" id="mountainResult"></div>
          </div>
        </div>

        <!-- Flow-only inputs (hidden until 'flow' selected) -->
        <div id="flowInputs" style="display: none;">
          <div class="flow-row">
            <label>
              Damage
              <input type="number" id="flowDamage" value="0" />
            </label>
            <label>
              Elemental Damage
              <input type="number" id="flowElementalDamage" value="0" />
            </label>
          </div>
          <div class="flow-row">
            <label>
              Dice Result
              <input type="number" id="flowDiceResult" value="0" />
            </label>
          </div>
          <div class="flow-row flow-actions">
            <button id="flowCalcBtn" onclick="calcFlow()">Calculate</button>
            <div class="result" id="flowResult"></div>
          </div>
        </div>

    </div>

    <!-- Attack form -->
    <div id="attack" class="form-section">
      <h3>On Attack</h3>
      <div class="result" id="attackInfo"></div>
    </div>

    <!-- Defense form -->
    <div id="defense" class="form-section">
        <h3>On Being Attacked</h3>
        <div class="result" id="defenceInfo"></div>
    </div>

    <!-- Crit form -->
    <div id="crit" class="form-section">
      <h3>On Critical Attack</h3>
      <div class="result" id="critInfo"></div>
    </div>

    <!-- Climb form -->
    <div id="climb" class="form-section">
      <h3>Climbing/Falling</h3>
      <div class="result" id="climbInfo"></div>
    </div>

  </div>

  <script>

    const CHARACTER = {
        level: 5,

        strMod: 0,
        dexMod: 3,
        conMod: 3,
        intMod: 3,
        wisMod: 2,
        chaMod: 0, // raw: -1, with ring(+1): 0

        speed: 40,
        profBonus: 3,
        armorClass: 18,
        dmgReduction: 6,
        dmgReductionElemental: 4,
        mad: "3d6",

        reachRange: 10,
    };

    let combatStance = "normal";


    const STANCE_INFO = {
        normal: "",
        mountain: {
            title: "â›°ï¸ Mountain Stance",
            info: "",
            reaction: `Reduce Melee attack within range (${CHARACTER.reachRange}ðŸ‘£)
                ðŸª–Sentinel: if the attack is not on me, I can attack`,
            madPoint: `ðŸ”µ Unrelenting: Add [Lvl ${CHARACTER.level}] to glancing blow`,
        },
        flow: {
            title: "ðŸŒŠ Flow Of All Things",
            info: "",
            reaction: `(melee) reduce damage + retaliate`,
            madPoint: `ðŸ”µ Aggressive Flow: Retaliate Twice against the same attack`,
        },
        wind: {
            title: "ðŸ’¨ Like the Wind",
            info: `Movement Doubled
                Add Wisdom to any Dex saving throw`,
            madPoint: `ðŸ”µ Breeze: Disingage + Dash as bonus action, jump doubled`
        }
    }




    function showForm(formId) {
        // Hide all forms
        document.querySelectorAll('.form-section').forEach(f => f.style.display = "none");
        // Show selected
        document.getElementById(formId).style.display = "block";

        // on attack info
        attackInfo = `Attack Roll: [d20ðŸŽ²] + [Dex ${CHARACTER.dexMod}] + [Prof ${CHARACTER.profBonus}]
            Damage: [MAD ${CHARACTER.mad}] + [Dex ${CHARACTER.dexMod}]
        
            ðŸŸ£ Piercer: Once per turn, re-roll one damage die

            ðŸŸ£ lvl5: Attack twice on regular attacks (not retaliatory)
            
            ðŸŸ£ BDazzle(lvl5): Once per round, when you hit a creature with a Rope dart or an Unarmed Strike,
             \tyou can spend 1 Martial Discipline Point to attempt to stun the enemy. The target must succeed on a
             \tConstitution saving throw or have the Stunned condition until the start of your next turn`;

        // on being attacked info
        defenceInfo = `Over powered if above armor+10: [${CHARACTER.armorClass + 10}]
        
            Reduce [DR ${CHARACTER.dmgReduction}] from damage
            
            ðŸŸ£ Glancing blow: once per turn, throw constitution save against attack roll, on success double DR`;

        // on crit attack info
        critInfo = `Double Damage
        
            ðŸŸ£ Piercer: Roll another damage die
            
            ðŸŸ£ Pendant: Add d6 Fire ðŸ”¥ Damage per dice`;

        // on crit attack info
        climbInfo = `lvl4: While wielding a Rope dart, you gain climbing speed equal to your normal movement speed [${CHARACTER.speed}].
            In addition, you can use your Reaction when you fall to mitigate damage you take from the fall by ðŸŽ² Dexterity ability check.`;

        document.getElementById("attackInfo").innerText = attackInfo;
        document.getElementById("defenceInfo").innerText = defenceInfo;
        document.getElementById("critInfo").innerText = critInfo;
        document.getElementById("climbInfo").innerText = climbInfo;
    }



    function updateState() {
        combatStance = document.getElementById("combatState").value;

        title = STANCE_INFO[combatStance].title
        info = STANCE_INFO[combatStance].info
        reaction = STANCE_INFO[combatStance].reaction
        madPoint = STANCE_INFO[combatStance].madPoint

        document.getElementById("combatStateDesc").innerText = `${title}\n${info}\nReaction: ${reaction}\n\n${madPoint}`;

        if (combatStance === 'mountain') {
          // show as flex so the rows and inputs arrange correctly
          document.getElementById('mountainInputs').style.display = 'flex';
        } else {
            document.getElementById('mountainInputs').style.display = 'none';
            document.getElementById('mountainResult').innerText = '';
        }

        if (combatStance === 'flow') {
          // show as flex so the rows and inputs arrange correctly
          document.getElementById('flowInputs').style.display = 'flex';
        } else {
            document.getElementById('flowInputs').style.display = 'none';
            document.getElementById('flowResult').innerText = '';
        }
    }

    function calcMountain() {
        const mountainDamage = Number(document.getElementById('mountainDamage').value) || 0;
        const mountainElementalDamage = Number(document.getElementById('mountainElementalDamage').value) || 0;
        const mountainDiceResult = Number(document.getElementById('mountainDiceResult').value) || 0;

        reducedDamage = Math.max(0, mountainDamage - CHARACTER.dmgReduction + mountainElementalDamage - CHARACTER.dmgReductionElemental)
        damageTaken = Math.max(0, reducedDamage - (mountainDiceResult + CHARACTER.dexMod + CHARACTER.level))
        retaliate = Math.min((mountainDiceResult + CHARACTER.dexMod + CHARACTER.level), reducedDamage)

        // example calculation (replace with your real formula)
        const result = "Damage Taken: " + damageTaken + " Retaliate: " + retaliate;

        document.getElementById('mountainResult').innerText = `Result: ${result}`;
    }

    function calcFlow() {
        const flowDamage = Number(document.getElementById('flowDamage').value) || 0;
        const flowElementalDamage = Number(document.getElementById('flowElementalDamage').value) || 0;
        const flowDiceResult = Number(document.getElementById('flowDiceResult').value) || 0;

        reducedDamage = Math.max(0, flowDamage - CHARACTER.dmgReduction + flowElementalDamage - CHARACTER.dmgReductionElemental)
        damageTaken = Math.max(0, reducedDamage - (flowDiceResult))
        retaliate = flowDiceResult + CHARACTER.dexMod + Math.min(reducedDamage, flowDiceResult)

        // example calculation (replace with your real formula)
        const result = "Damage Taken: " + damageTaken + " Retaliate: " + retaliate;

        document.getElementById('flowResult').innerText = `Result: ${result}`;
    }

  </script>
</body>
</html>
